<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! src/main/resources/legal-notices/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011-2015 ForgeRock AS.
  !    
-->
<chapter xml:id='chap-compatibility'
 xmlns='http://docbook.org/ns/docbook' version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook
                     http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'>
 <title>OpenAM Changes &amp; Deprecated Functionality</title>

 <para>This chapter covers both major changes to existing functionality, and
 also deprecated and removed functionality.</para>

 <section xml:id="changes">
  <title>Important Changes to Existing Functionality</title>

  <!-- New features in 13.0 -->
  <itemizedlist>

   <listitem>
    <para>
     The <literal>applications</literal> REST endpoint has changed.
    </para>
    <para>
     With the introduction of
     <link xlink:show="new" xlink:href="admin-guide#what-is-authz-policies"
      xlink:role="http://docbook.org/xlink/role/olink">resource types</link> into
     the policy model the <literal>/json/applications</literal> endpoint has
     changed, and the <link xlink:show="new"
                            xlink:href="dev-guide#rest-api-versioning"
      xlink:role="http://docbook.org/xlink/role/olink">REST resource
     version</link> upped to <literal>2.0</literal>.</para>
    <para>
     Version 2.0 of the endpoint includes a new <literal>resourceTypeUuids</literal>
     field in the JSON representation of applications, which holds the UUIDs of
     the associated resource types. The <literal>resources</literal> and
     <literal>actions</literal> fields have been removed. Version 1.0 of the
     endpoint is unchanged, providing backwards compatibility.
    </para>
    <para>Any existing applications will be converted to use the version 2.0
     JSON representation when upgrading OpenAM instances.</para>
    <itemizedlist>
     <listitem>
      <para><literal>/json/applications</literal> endpoint version 2.0</para>
<screen>
$ <userinput>curl \
  --header "Content-Type: application/json" \
  --header  "Accept-API-Version: resource=2.0, protocol=1.0" \
  --header "iPlanetDirectoryPro: AQIC5..." \
  https://openam.example.com:8443/openam/json/applications/myapplication
</userinput><computeroutput>{
    "creationDate": 1431363195434,
    "lastModifiedDate": 1431363197721,
    "conditions": [
        "NOT",
        "SimpleTime"
    ],
    "resourceComparator": null,
    "attributeNames": [ ],
    "saveIndex": null,
    "searchIndex": null,
    "editable": true,
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "OR"
    ],
    "entitlementCombiner": "DenyOverride",
    "resourceTypeUuids": [
        "12345a67-8f0b-123c-45de-6fab78cd01e4"
    ],
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "description": "My example application.",
    "realm": "/",
    "name": "myapplication"
}</computeroutput></screen>
     </listitem>
     <listitem>
      <para><literal>/json/applications</literal> endpoint version 1.0</para>
<screen>
$ <userinput>curl \
  --header "Content-Type: application/json" \
  --header  "Accept-API-Version: resource=1.0, protocol=1.0" \
  --header "iPlanetDirectoryPro: AQIC5..." \
  https://openam.example.com:8443/openam/json/applications/myapplication
</userinput><computeroutput>{
    "creationDate": 1431363195434,
    "lastModifiedDate": 1431363197721,
    "conditions": [
    "NOT",
        "SimpleTime"
    ],
    "resourceComparator": null,
    "attributeNames": [ ],
    "saveIndex": null,
    "searchIndex": null,
    "editable": true,
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "OR"
    ],
    "entitlementCombiner": "DenyOverride",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "description": "My example application.",
    "realm": "/",
    "name": "myapplication",
    "actions": {
        "POST": true,
        "PATCH": true,
        "GET": true,
        "DELETE": true,
        "OPTIONS": true,
        "PUT": true,
        "HEAD": true
    },
    "resources": [
        "*://*:*/*?*",
        "*://*:*/*"
    ]
}</computeroutput></screen>
     </listitem>
    </itemizedlist>
    <para>For more information, see
     <link xlink:show="new" xlink:href="dev-guide#rest-api-authz-applications"
      xlink:role="http://docbook.org/xlink/role/olink">Managing Applications</link>.</para>
   </listitem>

   <listitem>
    <para>
     The <literal>policies</literal> REST endpoint has changed.
    </para>
    <para>
     With the introduction of
     <link xlink:show="new" xlink:href="admin-guide#what-is-authz-policies"
      xlink:role="http://docbook.org/xlink/role/olink">resource types</link> into
     the policy model the <literal>/json/policies</literal> endpoint has
     changed, and the <link xlink:show="new"
                            xlink:href="dev-guide#rest-api-versioning"
      xlink:role="http://docbook.org/xlink/role/olink">REST resource
     version</link> upped to <literal>2.0</literal>.</para>
    <para>
     Version 2.0 of the endpoint includes a new <literal>resourceTypeUuid</literal>
     field in the JSON representation of policies, which holds the UUID of the
     associated resource type. Version 1.0 of the endpoint is unchanged,
     providing backwards compatibility.
    </para>
    <para>Any existing policies will be converted to use the version 2.0
     JSON representation when upgrading OpenAM instances.</para>
    <itemizedlist>
     <listitem>
      <para><literal>/json/policies</literal> endpoint v2.0</para>
<screen>
$ <userinput>curl \
  --header "Content-Type: application/json" \
  --header  "Accept-API-Version: resource=2.0, protocol=1.0" \
  --header "iPlanetDirectoryPro: AQIC5..." \
  https://openam.example.com:8443/openam/json/policies/mypolicy
</userinput><computeroutput>{
    "name": "mypolicy",
    "active": true,
    "description": "My example policy.",
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "GET": true
    },
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "subject": {
        "type": "AuthenticatedUsers"
    },
    "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": "2015-05-14T15:20:35.550Z",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": "2015-05-11T17:37:24.556Z"
}</computeroutput></screen>
     </listitem>
     <listitem>
      <para><literal>/json/policies</literal> endpoint v1.0</para>
<screen>
$ <userinput>curl \
  --header "Content-Type: application/json" \
  --header  "Accept-API-Version: resource=1.0, protocol=1.0" \
  --header "iPlanetDirectoryPro: AQIC5..." \
  https://openam.example.com:8443/openam/json/policies/mypolicy
</userinput><computeroutput>{
    "name": "mypolicy",
    "active": true,
    "description": "My example policy.",
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "GET": true
    },
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "subject": {
        "type": "AuthenticatedUsers"
    },
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": "2015-05-14T15:20:35.550Z",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": "2015-05-11T17:37:24.556Z"
}</computeroutput></screen>
     </listitem>
    </itemizedlist>
    <para>For more information, see
     <link xlink:show="new" xlink:href="dev-guide#rest-api-authz-policies"
      xlink:role="http://docbook.org/xlink/role/olink">Managing Policies</link>.
    </para>
   </listitem>

   <listitem>
    <para>
     The <literal>users</literal> REST endpoint has changed.
    </para>
    <para>
     Versions 1.2 and 2.1 of the endpoint include a new <literal>roles</literal>
     field in the JSON representation of a user, with a value of
     <literal>ui-admin</literal>, if an administrator is querying their own user
     details. Versions 1.1 and 2.0 of the endpoint are unchanged.
    </para>
    <para>For more information, see
     <olink targetdoc="dev-guide" targetptr="rest-api-read-identity" />.
    </para>
   </listitem>
  </itemizedlist>
 </section>

 <section xml:id="deprecated">
  <title>Deprecated Functionality</title>

   <para>
    This sections covers deprecated functionality in OpenAM.
   </para>
  
  <!-- Deprecated features in 13.0 -->
  <section>

   <title>Functionality Deprecated in OpenAM 13</title>

   <para>The following functionality is deprecated in OpenAM
    ${serverDocTargetVersion}, and is likely to be removed in a future
    release.
   </para>

   <itemizedlist>

    <listitem>
     <para>
      TODO: Update for the next release
     </para>
    </listitem>

   </itemizedlist>

  </section>

  <!-- Deprecated features in 12.0 -->
  <section>

   <title>Functionality Deprecated Since OpenAM 12</title>

   <para>
    The following functionality was deprecated in OpenAM 12,
    and is likely to be removed in a future release.
   </para>

   <itemizedlist>

    <listitem>
     <para>
      Classic (JATO-based) UI is deprecated for end user pages.
      OpenAM offers the JavaScript-based XUI as a replacement.
      Classic UI for end user pages is likely to be removed in a future release.
     </para>
    </listitem>

    <listitem>
     <para>Older REST services relying on the following endpoints are
      deprecated.</para>

     <itemizedlist>
      <listitem><para><literal>/identity/authorize</literal></para></listitem>
      <listitem><para><literal>/identity/isTokenValid</literal></para></listitem>
      <listitem><para><literal>/ws/1/entitlement/decision</literal></para></listitem>
      <listitem><para><literal>/ws/1/entitlement/decisions</literal></para></listitem>
      <listitem><para><literal>/ws/1/entitlement/entitlement</literal></para></listitem>
      <listitem><para><literal>/ws/1/entitlement/entitlements</literal></para></listitem>
     </itemizedlist>

     <para>The following table shows how legacy and newer endpoints
      correspond.</para>

     <table pgwide="1">
      <title>REST Endpoints</title>

      <tgroup cols="2">
       <colspec colnum="1" colwidth="1*"/>
       <colspec colnum="2" colwidth="1*"/>

       <thead>
        <row>
         <entry><link xlink:show="new" xlink:href="admin-guide#interface-stability"
                      xlink:role="http://docbook.org/xlink/role/olink">Deprecated</link> URIs</entry>
         <entry>Newer <link xlink:show="new" xlink:href="admin-guide#interface-stability"
                            xlink:role="http://docbook.org/xlink/role/olink">Evolving</link> URIs</entry>
        </row>
       </thead>

       <tbody>

        <row>
         <entry><literal>/identity/authorize</literal></entry>
         <entry><literal>/json/policies?_action=evaluate</literal>,
          <literal>/json/policies?_evaluateTree</literal></entry>
        </row>

        <row>
         <entry><literal>/identity/isTokenValid</literal></entry>
         <entry><literal>/json/sessions/<replaceable>tokenId</replaceable>?_action=validate</literal></entry>
        </row>

        <row>
         <entry><literal>/ws/1/entitlement/decision</literal>,
          <literal>/ws/1/entitlement/decisions</literal>,
          <literal>/ws/1/entitlement/entitlement</literal>,
          <literal>/ws/1/entitlement/entitlements</literal></entry>
         <entry><literal>/json/policies?_action=evaluate</literal>,
          <literal>/json/policies?_evaluateTree</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/applications</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/applicationtypes</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/conditiontypes</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/dashboard</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/decisionscombiners</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/policies</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/referrals</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/serverinfo</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/subjectattributes</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/json/subjecttypes</literal></entry>
        </row>

        <row>
         <entry>N/A</entry>
         <entry><literal>/xacml/policies</literal></entry>
        </row>
       </tbody>
      </tgroup>
     </table>

     <para>Find examples in the <citetitle>Developer Guide</citetitle> chapter <link
      xlink:href="dev-guide#sec-rest" xlink:role="http://docbook.org/xlink/role/olink"
      xlink:show="new"><citetitle>Using RESTful Web Services</citetitle></link>.</para>

     <para>Support for the older REST services is likely to be removed in a
      future release in favor of the newer REST services.</para>
    </listitem>

    <listitem>
     <para>With the implementation of XACML 3.0 support when importing and
     exporting policies the following <option>ssoadm</option> commands
      have been replaced:</para>

     <table>
     <title>Policy Import and Export with ssoadm</title>

     <tgroup cols="2">
     <colspec colnum="1" colwidth="1*"/>
     <colspec colnum="2" colwidth="1*"/>

     <thead>
      <row>
       <entry><link xlink:show="new" xlink:href="admin-guide#interface-stability"
                    xlink:role="http://docbook.org/xlink/role/olink">
        Deprecated</link> Command</entry>
       <entry>Newer <link xlink:show="new" xlink:href="admin-guide#interface-stability"
                          xlink:role="http://docbook.org/xlink/role/olink">
        Evolving</link> Command</entry>
      </row>
     </thead>

     <tbody>
     <row>
      <entry><literal>create-policies</literal></entry>
      <entry><literal>create-xacml</literal></entry>
     </row>
      <row>
       <entry><literal>delete-policies</literal></entry>
       <entry><literal>delete-xacml</literal></entry>
      </row>
      <row>
       <entry><literal>list-policies</literal></entry>
       <entry><literal>list-xacml</literal></entry>
      </row>
      <row>
       <entry><literal>update-policies</literal></entry>
       <entry><literal>create-xacml</literal></entry>
      </row>
     </tbody>
     </tgroup>
     </table>

     <para>For more information, see the <citetitle>OpenAM
      Reference</citetitle> section <link xlink:show="new"
      xlink:href="reference#ssoadm-1"
      xlink:role="http://docbook.org/xlink/role/olink">
      ssoadm — configure OpenAM core services</link>.
     </para>
    </listitem>

    <listitem>
     <para>
      The OAuth 2.0 plugin interface for custom scopes,
      <link
       xlink:href="${javadocBase}?org/forgerock/openam/oauth2/provider/Scope.html"
       xlink:show="new"><literal>Scope</literal></link>
      is deprecated and likely to be removed in a future release.
     </para>

     <para>
      Custom OAuth 2.0 scopes plugins now implement the
      <link
       xlink:href="${javadocBase}?org/forgerock/oauth2/core/ScopeValidator.html"
       xlink:show="new"
       ><literal>ScopeValidator</literal></link> interface instead.
      For an example, see the <citetitle>Developer's Guide</citetitle> chapter,
      <link
       xlink:href="dev-guide#sec-oauth2-scopes"
       xlink:role="http://docbook.org/xlink/role/olink"
       xlink:show="new"
       ><citetitle>Customizing OAuth 2.0 Scope Handling</citetitle></link>.
     </para>
    </listitem>

    <listitem>
     <para>
      The OAuth 2.0 plugin interface for custom response types,
      <link
       xlink:href="${javadocBase}?org/forgerock/openam/oauth2/provider/ResponseType.html"
       xlink:show="new"><literal>ResponseType</literal></link>
      is deprecated and likely to be removed in a future release.
     </para>

     <para>
      Custom OAuth 2.0 response type plugins now implement the
      <link
       xlink:href="${javadocBase}?org/forgerock/oauth2/core/ResponseTypeHandler.html"
       xlink:show="new"
       ><literal>ResponseTypeHandler</literal></link> interface instead.
     </para>
    </listitem>

   </itemizedlist>

  </section>

  <!-- Deprecated features in 11.0 -->
  <section>

   <title>Functionality Deprecated Since OpenAM 11</title>

   <para>
    The following functionality was deprecated in OpenAM 11,
    and is likely to be removed in a future release.
   </para>

   <itemizedlist>

    <listitem>
     <para>Older REST services relying on the following endpoints are
      deprecated.</para>

     <itemizedlist>
      <listitem><para><literal>/identity/attributes</literal></para></listitem>
      <listitem><para><literal>/identity/authenticate</literal></para></listitem>
      <listitem><para><literal>/identity/create</literal></para></listitem>
      <listitem><para><literal>/identity/delete</literal></para></listitem>
      <listitem><para><literal>/identity/logout</literal></para></listitem>
      <listitem><para><literal>/identity/read</literal></para></listitem>
      <listitem><para><literal>/identity/search</literal></para></listitem>
      <listitem><para><literal>/identity/update</literal></para></listitem>
     </itemizedlist>

     <para>The following table shows how legacy and newer endpoints
      correspond.</para>

     <table pgwide="1">
      <title>REST Endpoints</title>

      <tgroup cols="2">
       <colspec colnum="1" colwidth="1*"/>
       <colspec colnum="2" colwidth="1*"/>

       <thead>
        <row>
         <entry><link xlink:show="new" xlink:href="admin-guide#interface-stability"
                      xlink:role="http://docbook.org/xlink/role/olink">Deprecated</link> URIs</entry>
         <entry>Newer <link xlink:show="new" xlink:href="admin-guide#interface-stability"
                            xlink:role="http://docbook.org/xlink/role/olink">Evolving</link> URIs</entry>
        </row>
       </thead>

       <tbody>
        <row>
         <entry><literal>/identity/attributes</literal></entry>
         <entry><literal>/json/users</literal></entry>
        </row>

        <row>
         <entry><literal>/identity/authenticate</literal></entry>
         <entry><literal>/json/authenticate</literal></entry>
        </row>

        <row>
         <entry><literal>/identity/create</literal>, <literal>/identity/delete</literal>,
          <literal>/identity/read</literal>, <literal>/identity/search</literal>,
          <literal>/identity/update</literal></entry>
         <entry><literal>/json/agents</literal>, <literal>/json/groups</literal>,
          <literal>/json/realms</literal>, <literal>/json/users</literal></entry>
        </row>

        <row>
         <entry><literal>/identity/logout</literal></entry>
         <entry><literal>/json/sessions/?_action=logout</literal></entry>
        </row>

       </tbody>
      </tgroup>
     </table>

     <para>Find examples in the <citetitle>Developer Guide</citetitle> chapter <link
      xlink:href="dev-guide#sec-rest" xlink:role="http://docbook.org/xlink/role/olink"
      xlink:show="new"><citetitle>Using RESTful Web Services</citetitle></link>.</para>

     <para>Support for the older REST services is likely to be removed in a
      future release in favor of the newer REST services.</para>
    </listitem>

    <listitem>
     <para>With the implementation of the Persistent Cookie authentication module, the
     Core Authentication module persistent cookie options are deprecated and are
     likely to be removed in a future release.</para>
    </listitem>

   </itemizedlist>

  </section>

  <!-- Deprecated features in 10.0 -->
  <section>

   <title>Functionality Deprecated Since OpenAM 10</title>

   <para>
    The following functionality was deprecated in OpenAM 10,
    and is likely to be removed in a future release.
   </para>

   <itemizedlist>

    <listitem>
     <para>With the implementation of OAuth 2.0 in this release, OAuth 1.0 has been
     deprecated. OAuth 1.0 support was originally provided in OpenAM 9.</para>
    </listitem>

    <listitem>
     <para>The Netscape LDAP API is to be removed from OpenAM, with OpenAM
     using the OpenDJ LDAP SDK instead. This affects all classes in
     <literal>com.sun.identity.shared.ldap.*</literal> packages.</para>
    </listitem>

    <listitem>
     <para>OpenAM currently uses Sun Java System Application Framework (JATO).
     JATO is deprecated and is likely to be replaced in a future release.</para>
    </listitem>

   </itemizedlist>

  </section>

 </section>

 <section xml:id="removed">
  <title>Removed Functionality</title>

  <!-- Features removed from 13.0 -->
  <itemizedlist>
   <listitem>
    <para>
     The "Persistent Cookie (Legacy)" settings in the Core Authentication
     module have been removed. Configure persistent cookies with the
     <link
      xlink:href="admin-guide#persistent-cookie"
      xlink:role="http://docbook.org/xlink/role/olink"
      xlink:show="new"><citetitle>Persistent Cookie module</citetitle></link>.
    </para>
   </listitem>

   <listitem>
    <para>
     The Distributed Authentication User Interface (DAUI) has been removed from
     OpenAM ${serverDocTargetVersion}. You can deploy OpenIG or another reverse proxy
     to secure OpenAM in a firewall.
     For more information, see
     <link
      xlink:href="admin-guide#protect-network-access"
      xlink:role="http://docbook.org/xlink/role/olink"
      xlink:show="new"><citetitle>Protecting Network Access</citetitle></link>.
    </para>
   </listitem>

  </itemizedlist>
 </section>

</chapter>
